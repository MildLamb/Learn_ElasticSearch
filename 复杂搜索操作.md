# ES复杂的查询操作
- 查询的参数体以json字符串传递
  - query：查询条件
  - _source：指定显示的字段
  - sort：根据某个字段排序
  - 分页：from-从哪开始  size-返回多少数据
```Java
GET mildlamb/_search
{
  //查询参数以json字符串传递
  "query": {  
    "match": {
      "name": "kindred"
    }
  },
  //指定显示的字段,结果的过滤
  "_source": ["name","desc"],
  "sort": [
    {
      "age": {
        //  desc 降序，asc 升序
        "order": "asc"
      }
    }
  ],
  /*
    分页：from-从哪开始,索引下标从0开始
         size-每页显示多少数据
  */
  "from": 0,
  "size": 1
}
```

- 布尔值查询,多条件查询
  - must：所有的条件都要符合，相当于sql中的and
  - should：满足其中一个条件即可，相当于sql中的or
  - must_not：查询不满足条件的数据，相当于not
  - filter：过滤
    - range
      - gt 大于
      - gte 大于等于
      - lt 小于
      - lte 小于等于
```javascript
GET mildlamb/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "name": "kindred"
          }
        },
        {
          "match": {
            "age": 1600
          }
        }
      ],
      "filter": [
        {
          "range": {
            "age": {
              "gte": 1550,  //>=
              "lte": 1700   //<=
            }
          }
        }
      ]
    }
  }
}
```

- 多集条件查询
```javascript
GET mildlamb/_search
{
  "query": {
    "match": {
      //匹配tags字段中有，爱或者柔的文档
      "tags": "爱 柔"
    }
  }
}
```

- 精确查询
term查询是直接通过倒排索引指定的词条进行精确查找的  
- 关于分词
  - match，会使用分词器解析，先分析文档，然后再通过分析的文档进行查询  
  - term，直接查询精确的  
- 两个类型
  - text：text类型的字段会被分词器解析拆分
  - keyword：keyword类型的字段不会被我们的分词器解析拆分

```javascript
PUT testdb
{
  "mappings": {
    "properties": {
      "name": {
        "type": "text"
      },
      "desc": {
        "type": "keyword"
      }
    }
  }
}

PUT testdb/_doc/1
{
  "name": "qsj学java name",
  "desc": "qsj学java desc"
}

PUT testdb/_doc/2
{
  "name": "qsj学java name",
  "desc": "qsj学java desc2"
}


GET testdb/_search
{
  "query": {
    "term": {
      "name": "学"
    }
  }
}

GET testdb/_search
{
  "query": {
    "term": {
      "desc": "qsj学java desc"
    }
  }
}
```


- 精确查询多个值
```javascript
PUT testdb/_doc/3
{
  "t1": "22",
  "t2": "2021-12-16"
}

PUT testdb/_doc/4
{
  "t1": "33",
  "t2": "2021-12-17"
}

GET testdb/_search
{
  "query": {
    "bool": {
      "should": [
        {
          "term": {
            "t1": "22"
          }
        },
        {
          "term": {
            "t1": "33"
          }
        }
      ]
    }
  }
}

//或者

GET testdb/_search
{
  "query": {
    "bool": {
      "should": [
        {
          "terms": {
            "t1": [
              "22",
              "33"
            ]
          }
        }
      ]
    }
  }
}
```






# 查询结果
  - hit:(后面会用java操作这个对象)
    - 索引和文档的信息
    - 查询的结果总数
    - 查询出来的具体文档
    - 匹配分数
```javascript
{
  "took" : 654,
  "timed_out" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : {
      "value" : 3,
      "relation" : "eq"
    },
    "max_score" : 0.5662492,
    "hits" : [
      {
        "_index" : "mildlamb",
        "_type" : "_doc",
        "_id" : "1",
        "_score" : 0.5662492,
        "_source" : {
          "name" : "kindred千珏",
          "age" : 1600,
          "desc" : "死亡之灵",
          "tags" : [
            "温柔",
            "灵魂的指路人"
          ]
        }
      },
      {
        "_index" : "mildlamb",
        "_type" : "_doc",
        "_id" : "4",
        "_score" : 0.5662492,
        "_source" : {
          "name" : "小羊kindred",
          "age" : 1500,
          "desc" : "温柔的羊",
          "tags" : [
            "温柔",
            "体贴",
            "可爱"
          ]
        }
      },
      {
        "_index" : "mildlamb",
        "_type" : "_doc",
        "_id" : "2",
        "_score" : 0.45198363,
        "_source" : {
          "name" : "kindred温柔小羊",
          "age" : 9,
          "desc" : "冰封千年的猛兽",
          "tags" : [
            "亢奋",
            "暴怒",
            "可爱"
          ]
        }
      }
    ]
  }
}
```
